{% extends 'lms/base.html' %}
{% load static %}

{% block content %}
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

  .success-wrapper {
    font-family: 'Poppins', sans-serif;
    min-height: 80vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f9fafb;
    padding: 40px 16px;
  }

  .success-card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.08);
    max-width: 780px;
    width: 100%;
    overflow: hidden;
    animation: fadeSlideUp 0.6s ease both;
  }

  @keyframes fadeSlideUp {
    from { opacity: 0; transform: translateY(30px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* Top green banner */
  .success-banner {
    background: linear-gradient(135deg, #4caf50, #66bb6a);
    padding: 36px 40px 32px;
    text-align: center;
    color: #fff;
  }

  .checkmark-circle {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    background: rgba(255,255,255,0.25);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
    animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.3s both;
  }

  @keyframes pop {
    from { transform: scale(0); }
    to   { transform: scale(1); }
  }

  .checkmark-circle svg {
    width: 40px;
    height: 40px;
  }

  .success-banner h1 {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0 0 6px;
  }

  .success-banner p {
    font-size: 0.9rem;
    opacity: 0.9;
    margin: 0;
  }

  /* Body */
  .success-body {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
  }

  @media (max-width: 600px) {
    .success-body { grid-template-columns: 1fr; }
  }

  /* Left: order meta */
  .order-meta {
    padding: 32px 36px;
    border-right: 1px solid #f0f0f0;
  }

  .order-meta h3 {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #9e9e9e;
    margin: 0 0 20px;
  }

  .meta-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #f5f5f5;
    font-size: 0.875rem;
  }

  .meta-row:last-child { border-bottom: none; }

  .meta-label { color: #757575; }
  .meta-value { font-weight: 600; color: #212121; }

  .status-badge {
    background: #e8f5e9;
    color: #2e7d32;
    padding: 2px 10px;
    border-radius: 20px;
    font-size: 0.78rem;
    font-weight: 600;
  }

  /* Right: order summary */
  .order-summary {
    padding: 32px 36px;
    background: #fafffe;
  }

  .order-summary h3 {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: #9e9e9e;
    margin: 0 0 20px;
  }

  .course-row {
    display: flex;
    gap: 14px;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid #f0f0f0;
  }

  .course-thumb {
    width: 54px;
    height: 54px;
    border-radius: 8px;
    object-fit: cover;
    background: #e8f5e9;
    flex-shrink: 0;
  }

  .course-thumb-placeholder {
    width: 54px;
    height: 54px;
    border-radius: 8px;
    background: linear-gradient(135deg, #a5d6a7, #66bb6a);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    color: #fff;
    font-size: 1.4rem;
  }

  .course-info .course-title {
    font-weight: 600;
    font-size: 0.9rem;
    color: #212121;
    margin-bottom: 2px;
  }

  .course-info .course-instructor {
    font-size: 0.78rem;
    color: #9e9e9e;
  }

  .price-rows .price-row {
    display: flex;
    justify-content: space-between;
    font-size: 0.85rem;
    padding: 6px 0;
    color: #616161;
  }

  .price-row.discount { color: #e53935; }

  .price-row.total {
    border-top: 2px solid #e8f5e9;
    margin-top: 8px;
    padding-top: 12px;
    font-weight: 700;
    font-size: 1rem;
    color: #212121;
  }

  /* Footer */
  .success-footer {
    padding: 24px 36px;
    background: #f1fdf1;
    border-top: 1px solid #e8f5e9;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    flex-wrap: wrap;
  }

  .redirect-msg {
    font-size: 0.82rem;
    color: #757575;
  }

  .redirect-msg span {
    font-weight: 600;
    color: #4caf50;
  }

  .btn-go {
    background: #4caf50;
    color: #fff;
    border: none;
    padding: 12px 28px;
    border-radius: 8px;
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: background 0.2s;
  }

  .btn-go:hover { background: #388e3c; color: #fff; }

  .countdown {
    font-size: 0.78rem;
    color: #9e9e9e;
    margin-top: 4px;
  }
</style>

<div class="success-wrapper">
  <div class="success-card">

    <!-- Banner -->
    <div class="success-banner">
      <div class="checkmark-circle">
        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"/>
        </svg>
      </div>
      <h1>Congratulations! Your Purchase Is Complete</h1>
      <p>We will send you a confirmation email as soon as your order gets confirmed</p>
    </div>

    <!-- Body -->
    <div class="success-body">

      <!-- Left: Order Meta -->
      <div class="order-meta">
        <h3>Order Information</h3>

        <div class="meta-row">
          <span class="meta-label">Order Date</span>
          <span class="meta-value">{{ order_date }}</span>
        </div>
        <div class="meta-row">
          <span class="meta-label">Order Number</span>
          <span class="meta-value">#{{ order_id }}</span>
        </div>
        <div class="meta-row">
          <span class="meta-label">Payment Method</span>
          <span class="meta-value">{{ payment_method }}</span>
        </div>
        <div class="meta-row">
          <span class="meta-label">Order Status</span>
          <span class="status-badge">Confirmed</span>
        </div>
      </div>

      <!-- Right: Order Summary -->
      <div class="order-summary">
        <h3>Order Details</h3>

        <div class="course-row">
          {% if course.thumbnail %}
            <img src="{{ course.thumbnail.url }}" alt="{{ course.title }}" class="course-thumb">
          {% else %}
            <div class="course-thumb-placeholder">ðŸ“š</div>
          {% endif %}
          <div class="course-info">
            <div class="course-title">{{ course.title }}</div>
          </div>
        </div>

        <div class="price-rows">
          <div class="price-row">
            <span>Original Price</span>
            <span>â‚¹{{ course_price|floatformat:2 }}</span>
          </div>
          {% if is_discounted %}
          <div class="price-row discount">
            <span>Discount</span>
            <span>-â‚¹{{ discount_amount|floatformat:2 }}</span>
          </div>
          {% endif %}
          <div class="price-row">
            <span>Subtotal</span>
            <span>â‚¹{{ base_price|floatformat:2 }}</span>
          </div>
          <div class="price-row">
            <span>Tax (GST 18%)</span>
            <span>â‚¹{{ tax_amount|floatformat:2 }}</span>
          </div>
          <div class="price-row total">
            <span>Total Paid</span>
            <span>â‚¹{{ total_amount|floatformat:2 }}</span>
          </div>
        </div>
      </div>

    </div>

    <!-- Footer with redirect -->
    <div class="success-footer">
      <div>
        <div class="redirect-msg">You'll be redirected to <span>My Courses</span> automatically</div>
        <div class="countdown" id="countdown-text">Redirecting in <strong id="timer">5</strong> seconds...</div>
      </div>
      <a href="{% url 'my_courses' %}" class="btn-go" id="go-btn">Go to My Courses â†’</a>
    </div>

  </div>
</div>

<script>
  // Auto-redirect countdown
  let seconds = 5;
  const timerEl = document.getElementById('timer');
  const interval = setInterval(() => {
    seconds--;
    timerEl.textContent = seconds;
    if (seconds <= 0) {
      clearInterval(interval);
      window.location.href = "{% url 'my_courses' %}";
    }
  }, 1000);
</script>
{% endblock %}